{"version":3,"sources":["TotalEarningsCounter/TotalEarningsCounter.js"],"names":["TotalEarningsCounter","state","earningsEnd","earningsStart","functionsUtil","this","setProps","props","FunctionsUtil","loadUtils","loadTotalEarnings","prevProps","prevState","contractsInitialized","availableStrategies","JSON","stringify","isRisk","selectedStrategy","availableTokens","portfolio","getAccountPortfolio","account","depositedTokens","Object","keys","tokensBalance","filter","token","_this2","BNify","idleTokenBalance","gt","avgAPY","totalEarnings","totalAmountLent","asyncForEach","_ref","_Users_samuelecester_Desktop_git_idle_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__","_Users_samuelecester_Desktop_git_idle_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default","a","mark","_callee3","tokenConfig","_ref2","_ref3","tokenAprs","amountLent","tokenEarnings","tokenAPY","tokenWeight","amountLentToken","wrap","_context3","prev","next","Promise","all","getTokenAprs","getAmountLent","loadAssetField","sent","_Users_samuelecester_Desktop_git_idle_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","avgApy","tokenBalance","div","totalBalance","convertTokenBalance","plus","times","stop","_x3","apply","arguments","setState","_this3","counterStyle","lineHeight","color","theme","colors","copyColor","fontFamily","fonts","counter","fontWeight","isMobile","fontSize","length","forEach","p","decimals","maxPrecision","minPrecision","react__WEBPACK_IMPORTED_MODULE_10___default","createElement","rimble_ui__WEBPACK_IMPORTED_MODULE_9__","width","react_countup__WEBPACK_IMPORTED_MODULE_8___default","delay","decimal","separator","useEasing","duration","end","parseFloat","start","formattingFn","n","abbreviateNumber","_ref4","countUpRef","ref","style","size","Component"],"mappings":"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","file":"static/js/16.0acfdcd7.chunk.js","sourcesContent":["import CountUp from 'react-countup';\nimport { Box, Loader } from \"rimble-ui\";\nimport React, { Component } from 'react';\nimport FunctionsUtil from '../utilities/FunctionsUtil';\n\nclass TotalEarningsCounter extends Component {\n\n  state = {\n    earningsEnd:null,\n    earningsStart:null\n  }\n\n  // Utils\n  functionsUtil = null;\n\n  loadUtils(){\n    if (this.functionsUtil){\n      this.functionsUtil.setProps(this.props);\n    } else {\n      this.functionsUtil = new FunctionsUtil(this.props);\n    }\n  }\n\n  async componentWillMount(){\n    this.loadUtils();\n    this.loadTotalEarnings();\n  }\n\n  async componentDidUpdate(prevProps,prevState){\n    this.loadUtils();\n    const contractsInitialized = prevProps.contractsInitialized !== this.props.contractsInitialized;\n    const availableStrategiesChanged = !prevProps.availableStrategies && JSON.stringify(prevProps.availableStrategies) !== JSON.stringify(this.props.availableStrategies);\n    if (availableStrategiesChanged || contractsInitialized){\n      this.loadTotalEarnings();\n    }\n  }\n\n  async loadTotalEarnings(){\n\n    if (!this.props.availableStrategies || !this.props.contractsInitialized){\n      return true;\n    }\n    const isRisk = this.props.selectedStrategy === 'risk';\n\n    const availableTokens = this.props.availableTokens || {};\n    const portfolio = this.props.portfolio || await this.functionsUtil.getAccountPortfolio(availableTokens,this.props.account);\n    const depositedTokens = Object.keys(portfolio.tokensBalance).filter(token => ( this.functionsUtil.BNify(portfolio.tokensBalance[token].idleTokenBalance).gt(0) ));\n\n    let avgAPY = this.functionsUtil.BNify(0);\n    let totalEarnings = this.functionsUtil.BNify(0);\n    let totalAmountLent = this.functionsUtil.BNify(0);\n\n    await this.functionsUtil.asyncForEach(depositedTokens,async (token) => {\n      const tokenConfig = availableTokens[token];\n      const [\n        tokenAprs,\n        amountLent,\n        tokenEarnings\n      ] = await Promise.all([\n        this.functionsUtil.getTokenAprs(tokenConfig),\n        this.functionsUtil.getAmountLent([token],this.props.account),\n        this.functionsUtil.loadAssetField('earnings',token,tokenConfig,this.props.account,false),\n      ]);\n\n      const tokenAPY = this.functionsUtil.BNify(tokenAprs.avgApy);\n      const tokenWeight = portfolio.tokensBalance[token].tokenBalance.div(portfolio.totalBalance);\n      const amountLentToken = await this.functionsUtil.convertTokenBalance(amountLent[token],token,tokenConfig,isRisk);\n\n      if (tokenEarnings){\n        totalEarnings = totalEarnings.plus(tokenEarnings);\n      }\n\n      if (tokenAPY){\n        avgAPY = avgAPY.plus(tokenAPY.times(tokenWeight));\n      }\n\n      if (amountLentToken){\n        totalAmountLent = totalAmountLent.plus(amountLentToken);\n      }\n    });\n\n    const earningsStart = totalEarnings;\n    const earningsEnd = totalAmountLent.times(avgAPY.div(100));\n\n    this.setState({\n      earningsEnd,\n      earningsStart\n    });\n  }\n\n  render() {\n\n    const counterStyle = {\n      lineHeight:1,\n      color:this.props.theme.colors.copyColor,\n      fontFamily:this.props.theme.fonts.counter,\n      fontWeight: this.props.isMobile ? 600 : 700,\n      fontSize:this.props.isMobile ? '21px' : '1.7em',\n    };\n\n    // Replace props\n    if (this.props.counterStyle && Object.keys(this.props.counterStyle).length){\n      Object.keys(this.props.counterStyle).forEach(p => {\n        counterStyle[p] = this.props.counterStyle[p];\n      });\n    }\n\n    const decimals = this.props.decimals || 8;\n    const maxPrecision =  this.props.maxPrecision || 10;\n    const minPrecision =  this.props.minPrecision || 8;\n\n    return this.state.earningsStart && this.state.earningsEnd ? (\n      <Box\n        width={1}\n      >\n        <CountUp\n          delay={0}\n          decimal={'.'}\n          separator={''}\n          useEasing={false}\n          decimals={decimals}\n          duration={31536000}\n          end={parseFloat(this.state.earningsEnd)}\n          start={parseFloat(this.state.earningsStart)}\n          formattingFn={ n => '$ '+this.functionsUtil.abbreviateNumber(n,decimals,maxPrecision,minPrecision) }\n        >\n          {({ countUpRef, start }) => (\n            <span\n              ref={countUpRef}\n              style={counterStyle}\n            />\n          )}\n        </CountUp>\n      </Box>\n    ) : (\n      <Loader size={\"20px\"} />\n    );\n  }\n}\n\nexport default TotalEarningsCounter;\n"],"sourceRoot":""}